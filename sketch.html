<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Attracteurs de Lorenz - Points Blancs</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  </head>
  <body style="margin:0">
    <script>
      let sigma = 10;
      let rho = 28;
      let beta = 8 / 3;
      let dt = 0.01;
      let maxPoints = 200;

      let attractors = [];
      let num = 20;

      function setup() {
        createCanvas(600, 400, WEBGL);
        for (let i = 0; i < num; i++) {
          let initCond = (i + 1) * 0.05;
          let c = color((i + 1) / num * 255, 100, 255);
          attractors[i] = new Attractor(initCond, initCond, initCond, c);
        }
      }

      function draw() {
        background(30);
        orbitControl();
        scale(5);

        for (let i = 0; i < num; i++) {
          attractors[i].update();
          attractors[i].display();

          // Affiche le point blanc qui suit la derniÃ¨re position
          push();
          noStroke();
          fill(255);
          let lastPos = attractors[i].history[attractors[i].history.length - 1];
          if (lastPos) {
            translate(lastPos.x, lastPos.y, lastPos.z);
            sphere(0.2);
          }
          pop();
        }
      }

      class Attractor {
        constructor(x, y, z, col) {
          this.x = x;
          this.y = y;
          this.z = z;
          this.history = [];
          this.col = col;
        }

        update() {
          let dx = sigma * (this.y - this.x);
          let dy = this.x * (rho - this.z) - this.y;
          let dz = this.x * this.y - beta * this.z;

          this.x += dx * dt;
          this.y += dy * dt;
          this.z += dz * dt;

          this.history.push(createVector(this.x, this.y, this.z));
          if (this.history.length > maxPoints) this.history.shift();
        }

        display() {
          noFill();
          stroke(this.col);
          beginShape();
          for (let v of this.history) {
            vertex(v.x, v.y, v.z);
          }
          endShape();
        }
      }
    </script>
  </body>
</html>
